4.  BFD Control Packet Format
4.1.  Generic BFD Control Packet Format
   BFD Control packets are sent in an encapsulation appropriate to the
   environment.  The specific encapsulation is outside of the scope of
   this specification.  See the appropriate application document for
   encapsulation details.
   The BFD Control packet has a Mandatory Section and an optional
   Authentication Section.  The format of the Authentication Section, if
   present, is dependent on the type of authentication in use.
   The Mandatory Section of a BFD Control packet has the following
   format:
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Vers |  Diag   |Sta|P|F|C|A|D|M|  Detect Mult  |    Length     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       My Discriminator                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Your Discriminator                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Desired Min TX Interval                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   Required Min RX Interval                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 Required Min Echo RX Interval                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   An optional Authentication Section MAY be present:
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Auth Type   |   Auth Len    |    Authentication Data...     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   Version (Vers)
      The version number of the protocol.  This document defines
      protocol version 1.
   Diagnostic (Diag)
      A diagnostic code specifying the local system's reason for the
      last change in session state.  Values are:
         0 -- No Diagnostic
         1 -- Control Detection Time Expired
         2 -- Echo Function Failed
         3 -- Neighbor Signaled Session Down
         4 -- Forwarding Plane Reset
         5 -- Path Down
         6 -- Concatenated Path Down
         7 -- Administratively Down
         8 -- Reverse Concatenated Path Down
      9-31 -- Reserved for future use
      This field allows remote systems to determine the reason that the
      previous session failed, for example.
   State (Sta)
      The current BFD session state as seen by the transmitting system.
      Values are:
         0 -- AdminDown
         1 -- Down
         2 -- Init
         3 -- Up
   Poll (P)
      If set, the transmitting system is requesting verification of
      connectivity, or of a parameter change, and is expecting a packet
      with the Final (F) bit in reply.  If clear, the transmitting
      system is not requesting verification.
   Final (F)
      If set, the transmitting system is responding to a received BFD
      Control packet that had the Poll (P) bit set.  If clear, the
      transmitting system is not responding to a Poll.
   Control Plane Independent (C)
      If set, the transmitting system's BFD implementation does not
      share fate with its control plane (in other words, BFD is
      implemented in the forwarding plane and can continue to function
      through disruptions in the control plane).  If clear, the
      transmitting system's BFD implementation shares fate with its
      control plane.
      The use of this bit is application dependent and is outside the
      scope of this specification.  See specific application
      specifications for details.
   Authentication Present (A)
      If set, the Authentication Section is present and the session is
      to be authenticated (see section 6.7 for details).
   Demand (D)
      If set, Demand mode is active in the transmitting system (the
      system wishes to operate in Demand mode, knows that the session is
      Up in both directions, and is directing the remote system to cease
      the periodic transmission of BFD Control packets).  If clear,
      Demand mode is not active in the transmitting system.
   Multipoint (M)
      This bit is reserved for future point-to-multipoint extensions to
      BFD.  It MUST be zero on both transmit and receipt.
   Detect Mult
      Detection time multiplier.  The negotiated transmit interval,
      multiplied by this value, provides the Detection Time for the
      receiving system in Asynchronous mode.
   Length
      Length of the BFD Control packet, in bytes.
   My Discriminator
      A unique, nonzero discriminator value generated by the
      transmitting system, used to demultiplex multiple BFD sessions
      between the same pair of systems.
   Your Discriminator
      The discriminator received from the corresponding remote system.
      This field reflects back the received value of My Discriminator,
      or is zero if that value is unknown.
   Desired Min TX Interval
      This is the minimum interval, in microseconds, that the local
      system would like to use when transmitting BFD Control packets,
      less any jitter applied (see section 6.8.2).  The value zero is
      reserved.
   Required Min RX Interval
      This is the minimum interval, in microseconds, between received
      BFD Control packets that this system is capable of supporting,
      less any jitter applied by the sender (see section 6.8.2).  If
      this value is zero, the transmitting system does not want the
      remote system to send any periodic BFD Control packets.
   Required Min Echo RX Interval
      This is the minimum interval, in microseconds, between received
      BFD Echo packets that this system is capable of supporting, less
      any jitter applied by the sender (see section 6.8.9).  If this
      value is zero, the transmitting system does not support the
      receipt of BFD Echo packets.
   Auth Type
      The authentication type in use, if the Authentication Present (A)
      bit is set.
         0 - Reserved
         1 - Simple Password
         2 - Keyed MD5
         3 - Meticulous Keyed MD5
         4 - Keyed SHA1
         5 - Meticulous Keyed SHA1
     6-255 - Reserved for future use
   Auth Len
      The length, in bytes, of the authentication section, including the
      Auth Type and Auth Len fields.
4.2.  Simple Password Authentication Section Format
   If the Authentication Present (A) bit is set in the header, and the
   Authentication Type field contains 1 (Simple Password), the
   Authentication Section has the following format:
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Auth Type   |   Auth Len    |  Auth Key ID  |  Password...  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ...                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   Auth Type
      The Authentication Type, which in this case is 1 (Simple
      Password).
   Auth Len
      The length of the Authentication Section, in bytes.  For Simple
      Password authentication, the length is equal to the password
      length plus three.
   Auth Key ID
      The authentication key ID in use for this packet.  This allows
      multiple keys to be active simultaneously.
   Password
      The simple password in use on this session.  The password is a
      binary string, and MUST be from 1 to 16 bytes in length.  The
      password MUST be encoded and configured according to section
      6.7.2.
4.3.  Keyed MD5 and Meticulous Keyed MD5 Authentication Section Format
   The use of MD5-based authentication is strongly discouraged.
   However, it is documented here for compatibility with existing
   implementations.
   If the Authentication Present (A) bit is set in the header, and the
   Authentication Type field contains 2 (Keyed MD5) or 3 (Meticulous
   Keyed MD5), the Authentication Section has the following format:
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Auth Type   |   Auth Len    |  Auth Key ID  |   Reserved    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Sequence Number                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Auth Key/Digest...                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ...                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   Auth Type
      The Authentication Type, which in this case is 2 (Keyed MD5) or 3
      (Meticulous Keyed MD5).
   Auth Len
      The length of the Authentication Section, in bytes.  For Keyed MD5
      and Meticulous Keyed MD5 authentication, the length is 24.
   Auth Key ID
      The authentication key ID in use for this packet.  This allows
      multiple keys to be active simultaneously.
   Reserved
      This byte MUST be set to zero on transmit, and ignored on receipt.
   Sequence Number
      The sequence number for this packet.  For Keyed MD5
      Authentication, this value is incremented occasionally.  For
      Meticulous Keyed MD5 Authentication, this value is incremented for
      each successive packet transmitted for a session.  This provides
      protection against replay attacks.
   Auth Key/Digest
      This field carries the 16-byte MD5 digest for the packet.  When
      the digest is calculated, the shared MD5 key is stored in this
      field, padded to 16 bytes with trailing zero bytes if needed.  The
      shared key MUST be encoded and configured to section 6.7.3.
4.4.  Keyed SHA1 and Meticulous Keyed SHA1 Authentication Section Format
   If the Authentication Present (A) bit is set in the header, and the
   Authentication Type field contains 4 (Keyed SHA1) or 5 (Meticulous
   Keyed SHA1), the Authentication Section has the following format:
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Auth Type   |   Auth Len    |  Auth Key ID  |   Reserved    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Sequence Number                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Auth Key/Hash...                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ...                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   Auth Type
      The Authentication Type, which in this case is 4 (Keyed SHA1) or 5
      (Meticulous Keyed SHA1).
   Auth Len
      The length of the Authentication Section, in bytes.  For Keyed
      SHA1 and Meticulous Keyed SHA1 authentication, the length is 28.
   Auth Key ID
      The authentication key ID in use for this packet.  This allows
      multiple keys to be active simultaneously.
   Reserved
      This byte MUST be set to zero on transmit and ignored on receipt.
   Sequence Number
      The sequence number for this packet.  For Keyed SHA1
      Authentication, this value is incremented occasionally.  For
      Meticulous Keyed SHA1 Authentication, this value is incremented
      for each successive packet transmitted for a session.  This
      provides protection against replay attacks.
   Auth Key/Hash
      This field carries the 20-byte SHA1 hash for the packet.  When the
      hash is calculated, the shared SHA1 key is stored in this field,
      padded to a length of 20 bytes with trailing zero bytes if needed.
      The shared key MUST be encoded and configured to section 6.7.4.